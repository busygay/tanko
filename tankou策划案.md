***

# 游戏策划案：防御塔-答题 (Quiz-Defense)

### **游戏机制核心概念总结：防御塔-答题**

这是一个将**知识问答**与**塔防策略**深度融合的游戏机制。玩家的核心任务是通过回答问题来获取战斗资源，并利用这些资源和策略性技能来抵御敌人的进攻。

游戏的核心在于平衡**知识储备**、**风险管理**和**战术决策**。

### **一、 核心资源系统**

游戏构建了一个三位一体、相互关联的资源循环系统。

| 资源名称 | 获取方式 | 主要用途 | 战略价值 |
| :--- | :--- | :--- | :--- |
| **能量点 (Energy Point, EP)** | 每答对一题获得 `+1` 点；答错时会 `-1` 点作为惩罚：初始值是5点 | 积攒以获取行动点 | 核心的长期战略资源，是获取终极资源“行动点”的唯一途径，承载着答题风险。 |
| **子弹 (Bullet)** | 1. 每答对一题获得 `+1` 颗；2. 消耗行动点可一次性装满 | 防御塔进行攻击的基础消耗品 | 直接影响战场的即时火力输出，是战术执行的基础。 |
| **行动点 (Action Point, AP)** | 能量点积满 `10` 点时获得 `+1` 点 | 消耗 `1` 点可立即重新装满子弹 | 强大的战略级资源，能在关键时刻提供爆发性的火力支援，扭转战局。 |

### **二、玩家基本单位**

玩家控制的主要防御单位具有以下基础属性：

| 属性名称 | 基础数值 | 说明 |
|:---------|:---------|:------|
| 攻击力(ATT) | 10 | 每发子弹造成的基础伤害值 |
| 生命值(HP) | 10 | 玩家可承受的最大伤害值 |
|暴击率|10%|一定概率暴击|
| 攻击速度 | 1次/秒 | 基础射击频率，可通过技能提升 |
| 射程 | 以player为圆心半径200px的圆| 可攻击视野内任意位置的敌人 |
| 位置 | 场景中间偏上位置 | 固定位置，无法移动 |


玩家单位作为核心防御塔，固定在场景中间偏上的位置，不具备移动能力。需要通过答题获取资源来维持战斗，同时合理运用技能来提升战斗效能。死亡后游戏结束。

### **三、游戏数值计算系统**

#### 1. 伤害计算基础公式

```
基础伤害 = 攻击力 × (1 + 攻击力加成) × 全局伤害加成
真实伤害 = 基础伤害 × 真实伤害系数
普通伤害 = 基础伤害 × (1 - 敌人护甲减免率)
暴击伤害 = 普通伤害 × (1 + 暴击系数)
最终伤害 = 真实伤害 + 暴击伤害
```
#### 2. 伤害加成系统

| 加成类型 | 计算方式 | 数值范围 | 触发条件 |
| :--- | :--- | :--- | :--- |
| **攻击力加成** | 乘算 | 0% ~ +∞% | 技能、buff等效果 |
| **全局伤害加成** | 乘算 | 0% ~ +∞% | 技能、buff等效果|
| **真实伤害系数** | 独立计算 | 0 - 0.3 | 技能、buff等效果|
| **暴击系数** | 乘算 | 50% - +无穷% | 基础10%概率 |
| **护甲减免** | 减算 | 0% - 100% | 敌人固有属性 |

各类加成可以同时存在并相互叠加，构成复杂的伤害计算体系。通过合理搭配技能，玩家可以追求更高的伤害输出。


### **四、技能触发器系统 (Skill Triggers)**


技能系统将玩家的答题表现与战场效果紧密相连。每个触发器下可挂载多个技能，但每次触发仅激活一个。

| 触发器名称 | 触发条件 | 设计目的与战略意义 |
| :--- | :--- | :--- |
| `onCombo` | 处于连续答对状态时，**每10秒触发一次** | 奖励持续稳定的表现，提供稳定的增益效果。 |
| `twoCombo` | **达成二连答**时触发一次 | 提供初期的、低门槛的连答奖励，鼓励玩家快速进入状态。 |
| `fiveCombo` | **达成五连答**时触发一次 | 提供强大的阶段性奖励，激励玩家挑战更高的连答数。 |
| `brokenCombo` | 连答状态中断时（**特指答错题目时**）触发一次 | 既是风险也是机遇。玩家可配置防御性技能来弥补失误，或配置特殊技能进行战术转换。 |
| `APGained` | 获得一点行动点时触发一次 | 强化获取高级资源的“里程碑时刻”，给予玩家额外的战略回报。 |
| `APSpent` | 消耗一点行动点时触发一次 | 使行动点的使用更具策略性，除了补充子弹外，还能附带一次性的强大战术效果。 |

### **五、 核心博弈点：答错 vs. 跳过**

设立“跳过”按钮旨在区分**“被迫的失败”**与**“主动的策略”**。

#### 1. 决策点对比

| 对比维度 | **答题错误 (Answering Wrong)** | **跳过题目 (Skipping)** |
| :--- | :--- | :--- |
| **本质定义** | 一次**失败的尝试** | 一次**主动的规避** |
| **资源后果** | **惩罚性**：`-1` 能量点 | **机会成本**：不获得任何资源，保住现有能量点 |
| **技能关联** | 触发 `brokenCombo` | **不触发任何技能**（遵循纯粹机会成本模型） |
| **战略意义** | 高风险的赌博行为，可能导致资源倒退 | **零风险的稳健选择**，用于**保护进度**和**管理节奏** |
| **玩家心态** | 承担风险，接受后果 | 权衡利弊，策略取舍 |

#### 2. “跳过”按钮的设计哲学探讨

本策划案的**共识**是采用**纯粹机会成本模型**：

*   **核心理念**：跳过即放弃，其唯一功能是**规避“答错扣分”的风险**。
*   **机制**：选择跳过时，不获得任何资源，也不损失任何资源，**不触发任何技能**。
*   **结论**：这是一种稳健、优雅的设计，将“跳过”精准地定位为一个纯粹的**防御性**和**风险管理**工具。

### **四、 技能树与机制设计**

#### 1. 基础强化系列：强化训练

| 系列名 | 技能名 | 前置技能 | 内容（主动技能） | 关键机制与优化点 |
| :--- | :--- | :--- | :--- | :--- |
| 强化训练 | 攻击力up | 无 | 攻击力+10% | 启动型 Buff，需定义持续时间/冷却时间。 |
| 强化训练 | 攻击cdDown | 无 | 攻击cd-10%，最多减少至0.1s | 启动型 Buff，需定义持续时间/冷却时间。 |

#### 2. 弹药分裂与弹射系列：枪斗术

| 系列名 | 技能名 | 前置技能 | 内容（主动技能） | 关键机制与优化点 |
| :--- | :--- | :--- | :--- | :--- |
| 枪斗术 | QQ弹 | 无 | 触发技能时，【弹射】层数+1。每层【弹射】可使普通攻击的子弹在击中敌人后弹射一次（目标不能相同）。 | **层数制 Buff**： 每次普攻消耗一层。剩余层数保留并可叠加。 |
| 枪斗术 | 强力QQ弹 | QQ弹 | (被动) 【弹射】效果的弹射次数+1。 | 被动技能，强化【弹射】效果。 |
| 枪斗术 | 一枪双击 | 无 | 触发技能时，【分裂弹】层数+1。每层【分裂弹】可使普通攻击额外攻击一名敌人（目标不能相同）。 | **层数制 Buff**： 每次普攻消耗 Min(当前层数, 可用的额外目标数) 层。剩余层数保留并可叠加。 |

#### 3. 召唤系列：三重协议

| 系列名 | 技能名 | 前置技能 | 内容（主动技能） | 关键机制与优化点 |
| :--- | :--- | :--- | :--- | :--- |
| 三重协议 | BT-7270 | 无 | 生成防御塔bt7270 | 关联特殊单位机制，需定义触发方式（如主动技能、特定触发器）。 |

### **六、特殊机制说明**
### 1.BT-7270
BT-7270 是一个可生成的自动机枪炮塔，上限一个。

| 属性/机制 | 数值/说明 | 备注 |
| :--- | :--- | :--- |
| 存活时间 | 10 秒 | |
| 炮塔伤害 | 玩家伤害的 10% (每颗子弹) | |
| 射击模式 | 每次发射 4 颗子弹，每颗间隔 0.15s，一次性发射完。冷却 0.5s 后重新进入发射状态。 | |
| 索敌速度 | 炮身旋转速度 3 秒一圈。 | |

### 2. 火球术 (Fireball)
“火球术”是一个主动召唤技能，它会生成一个追踪敌人的火球。

| 属性/机制 | 数值/说明 | 备注 |
| :--- | :--- | :--- |
| 技能类型 | 主动召唤技能 | 在玩家位置生成一个火球，飞向目标。 |
| 移动速度 | 200 像素/秒 | 火球以固定速度直线飞向目标初始位置。 |
| 伤害模式 | 范围伤害 (AoE) | 撞击到目标后爆炸，对爆炸范围内的所有敌人造成伤害。 |
| 伤害计算 | 造成玩家一定百分比的攻击力伤害。 | 具体伤害数值由技能等级或玩家属性决定。 |
| 生命周期 | 撞击敌人后消失 | 一次性消耗品。 ||




### 七、关卡设计

根据 `level.gd` 脚本，游戏关卡设计遵循动态难度调整的无限模式。本设计旨在根据关卡进度动态调整敌人数量与属性，确保挑战性持续增长。

#### 敌人数量设计

| 关卡要素 | 设计规则 | 备注 |
| :--- | :--- | :--- |
| **关卡进程** | 游戏关卡数 (`currentLevel`) 无上限，从第 1 关开始。 | 每通过一关，`currentLevel` 自动加 1。 |
| **普通敌人数量** | `(当前关卡数 - 1) * 3 + 5` | 线性增长，确保基础挑战难度稳步提升。 |
| **精英敌人数量** | `普通敌人数量 / 5` (取整) | 精英敌人是普通敌人的强化版，拥有 **1.2 ~ 1.8** 倍的随机属性乘数。 |
| **敌人种类解锁** | 每 **5** 个关卡解锁一种新的敌人类型。 | 关卡 1-5 只有一种敌人，关卡 6-10 会出现两种，以此类推。 |
| **Boss 战** | 每 **5** 个关卡 (第 5, 10, 15... 关) 会出现一个 Boss。 | Boss 拥有固定的 **2.0** 倍属性乘数，是关卡的终极挑战。 |
| **生成机制** | 所有敌人（普通、精英、Boss）混合并随机排序后生成。 | 敌人从屏幕边缘的随机位置出现，生成间隔会从 1.0 秒动态缩短至 0.5 秒，增加后期压力。 |

```mermaid
xychart-beta
    title "敌人数量随关卡变化图"
        x-axis "关卡 (Level)" [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        y-axis "敌人数量 (Count)"
        line "普通敌人" [5, 8, 11, 14, 17, 20, 23, 26, 29, 32]
        line "精英敌人" [1, 1, 2, 2, 3, 4, 4, 5, 5, 6]
        line "Boss" [0, 0, 0, 0, 1, 0, 0, 0, 0, 1]
```

#### 敌人属性设计

所有敌人的基础属性会随关卡数 (`currentLevel`) 提升。

| 属性 | 计算公式 | 说明 |
| :--- | :--- | :--- |
| **基础生命值 (Health)** | `5 + 2 * floor(当前关卡数 / 5)` | 敌人的基础生命值每 5 个关卡会阶梯式增长 2 点，形成阶段性的难度提升。 |
| **基础移动速度 (Speed)** | `基础速度 * (0.8 ~ 1.2 的随机值)` | 敌人的速度会在其基础值上下 20% 的范围内随机浮动，为战场带来更多变数。 |

##### 特殊敌人属性乘数

精英和 Boss 单位会基于一个属性乘数 (`Mul`) 对其基础属性进行强化，使其成为更严峻的挑战。

*   **精英敌人乘数 (`Mul`)**: 在 `1.2` 到 `1.8` 之间随机。
*   **Boss 乘数 (`Mul`)**: 固定为 `2.0`。

| 属性 | 强化公式 | 设计意图与战略影响 |
| :--- | :--- | :--- |
| **最终生命值** | `基础生命值 * Mul` | 大幅提升生存能力，成为需要优先处理或集中火力的目标。 |
| **最终尺寸** | `基础尺寸 * Mul` | 体型与威胁成正比，视觉上更具压迫感，同时也更容易被玩家的攻击命中。 |
| **最终速度** | `基础移动速度 * (2.0 - Mul)` | **反向关联机制**：属性乘数越高的敌人，移动速度越慢。这是一种平衡性设计，给予玩家应对强敌的策略空间。 |
| **最终伤害** | `基础伤害 * Mul` | 攻击威胁性显著增强，对玩家的生存构成直接挑战。 |
#### 敌人总血量与关卡关系分析

为了更好地理解关卡的难度曲线，我们拟合了敌人总血量随关卡数增长的趋势。此分析假设精英敌人的属性乘数取平均值 `1.6`。

##### 总血量计算公式

```
// 1. 定义关卡变量
L = 当前关卡数

// 2. 计算各类敌人数量
普通敌人总数 (N_total) = (L - 1) * 3 + 5
精英敌人数量 (N_elite) = floor(N_total / 5)
普通敌人净数量 (N_normal) = N_total - N_elite
Boss数量 (N_boss) = (L % 5 == 0) ? 1 : 0

// 3. 计算基础生命值
基础生命值 (H_base) = 5 + 2 * floor(L / 5)

// 4. 计算各类敌人总血量
普通敌人总血量 = N_normal * H_base
精英敌人总血量 = N_elite * H_base * 1.6
Boss总血量 = N_boss * H_base * 2.0

// 5. 计算关卡总血量
关卡总血量 (H_total) = 普通敌人总血量 + 精英敌人总血量 + Boss总血量
```

##### 关卡总血量示例

| 关卡 (L) | 普通敌人总数 | 精英敌人数量 | Boss数量 | 基础生命值 | 关卡总血量 (H_total) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | 5 | 1 | 0 | 5 | 28.0 |
| 5 | 17 | 3 | 1 | 7 | 145.6 |
| 10 | 32 | 6 | 1 | 9 | 338.4 |
| 15 | 47 | 9 | 1 | 11 | 598.4 |
| 20 | 62 | 12 | 1 | 13 | 925.6 |

##### 总血量增长趋势图

```mermaid
xychart-beta
    title "敌人总血量随关卡变化趋势"
        x-axis "关卡 (Level)" [1, 5, 10, 15, 20]
        y-axis "总血量 (Total Health)"
        line "总血量" [28, 145.6, 338.4, 598.4, 925.6]
```
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTIwODYwMDY3MzVdfQ==
-->
