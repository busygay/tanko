# Tankou 开发环境搭建指南

本文档为 Tankou（弹口）项目提供完整的开发环境搭建指南，帮助新开发者快速配置开发环境并开始项目开发。

## 目录

- [前置要求](#前置要求)
- [项目获取和初始化](#项目获取和初始化)
- [Godot编辑器配置](#godot编辑器配置)
- [依赖管理](#依赖管理)
- [运行和测试](#运行和测试)
- [开发工具推荐](#开发工具推荐)
- [常见问题解决](#常见问题解决)

## 前置要求

### Godot引擎版本要求

- **推荐版本**: Godot 4.3 或更高版本
- **最低版本**: Godot 4.2
- **下载地址**: [Godot官方下载页面](https://godotengine.org/download/)

> **注意**: 请确保下载的是标准版本而非.NET版本，因为本项目使用GDScript而非C#。

### 操作系统支持

| 操作系统 | 支持状态 | 推荐版本 | 备注 |
|---------|---------|---------|------|
| Windows | ✅ 完全支持 | Windows 10/11 | 主要开发平台 |
| macOS | ✅ 支持 | macOS 10.14+ | 需要额外配置 |
| Linux | ✅ 支持 | Ubuntu 18.04+ | 需要安装额外依赖 |

### 硬件要求

| 组件 | 最低要求 | 推荐配置 |
|------|---------|---------|
| CPU | 双核 2.0 GHz | 四核 3.0 GHz |
| 内存 | 4 GB RAM | 8 GB RAM |
| 显卡 | 支持 OpenGL 3.3 | 支持 OpenGL 4.0+ |
| 存储 | 2 GB 可用空间 | 5 GB 可用空间 |

### 必备软件

1. **Git** - 版本控制工具
   ```bash
   # Windows (使用 Chocolatey)
   choco install git
   
   # macOS (使用 Homebrew)
   brew install git
   
   # Ubuntu/Debian
   sudo apt-get install git
   ```

2. **代码编辑器** (可选，用于外部编辑)
   - Visual Studio Code (推荐)
   - Sublime Text
   - Notepad++

3. **图像/音频编辑工具** (可选，用于资源修改)
   - 图像: GIMP, Photoshop, Aseprite
   - 音频: Audacity, Adobe Audition

## 项目获取和初始化

### Git克隆

1. **克隆项目仓库**
   ```bash
   git clone [项目仓库地址]
   cd tankou
   ```

2. **检查项目结构**
   ```bash
   # 查看主要目录结构
   ls -la
   ```

3. **验证Git配置**
   ```bash
   git config --list
   ```

### 项目结构说明

```
tankou/
├── asset/                  # 游戏资源文件（图片、音频等）
├── enemy/                  # 敌人相关脚本和场景
├── global/                 # 全局管理器脚本
│   ├── jlptn_5.gd         # JLPT词汇数据管理
│   ├── eventmanger.gd      # 事件管理器
│   ├── audio_manager.gd    # 音频管理器
│   ├── level.gd            # 关卡管理器
│   └── skill_manager.gd    # 技能管理器
├── globalSkillData/        # 全局技能数据
├── main/                   # 主游戏场景
│   ├── UI/                # 用户界面组件
│   ├── main.gd            # 主游戏逻辑
│   └── player.gd          # 玩家控制
├── menu/                   # 菜单场景
├── shop/                   # 商店系统
├── skill/                  # 技能系统
├── sounds/                 # 音频文件
├── tigger/                 # 技能触发器
├── word/                   # 词汇数据文件
├── addons/                 # 插件目录
│   └── simple_gdscript_formatter/  # 代码格式化插件
├── docs/                   # 项目文档
├── project.godot           # Godot项目配置
└── README.md               # 项目说明文档
```

### 首次运行准备

1. **检查项目完整性**
   ```bash
   # 确保所有必要文件存在
   ls project.godot
   ls -la addons/
   ls -la asset/
   ```

2. **设置文件权限** (Linux/macOS)
   ```bash
   # 确保脚本文件有执行权限
   chmod +x *.gd
   ```

3. **初始化Git子模块** (如果有)
   ```bash
   git submodule update --init --recursive
   ```

## Godot编辑器配置

### 项目导入步骤

1. **启动Godot编辑器**
   - 双击Godot可执行文件
   - 或从命令行启动: `godot --editor`

2. **导入项目**
   - 点击"导入"按钮
   - 浏览到项目根目录
   - 选择 `project.godot` 文件
   - 点击"打开"

3. **等待资源导入**
   - 首次导入可能需要几分钟
   - 观察底部进度条
   - 完成后会显示项目场景

   ![项目导入界面](images/project-import.png) *图：项目导入界面*

### 编辑器设置优化

1. **界面布局设置**
   - 菜单: 编辑器 → 编辑器布局 → 选择适合的布局
   - 推荐: 2D布局或默认布局

2. **代码编辑器设置**
   - 菜单: 编辑器 → 编辑器设置
   - 文本编辑器 → 缩进 → 设置缩进大小为4
   - 文本编辑器 → 缩进 → 启用"自动缩进"
   - 文本编辑器 → 高亮 → 启用"语法高亮"

3. **运行设置**
   - 菜单: 项目 → 项目设置
   - 主场景 → 确保设置为 `uid://b2srsnxwwp6yd` (main.tscn)
   - 显示 → 窗口 → 视口宽度: 1080, 高度: 1920

4. **调试设置**
   - 菜单: 调试 → 调试器设置
   - 启用"调试时暂停"
   - 启用"显示调试信息"

### 插件配置（simple_gdscript_formatter）

1. **验证插件状态**
   - 菜单: 项目 → 项目设置 → 插件
   - 确保"Simple Gdscript Formatter"已启用

2. **配置格式化规则**
   - 插件默认使用标准GDScript格式化规则
   - 快捷键: `Ctrl + Alt + L` (Windows/Linux) 或 `Cmd + Alt + L` (macOS)

3. **自定义格式化** (可选)
   - 编辑 `addons/simple_gdscript_formatter/rules/` 下的文件
   - 根据团队需求调整格式化规则

### 版本控制设置

1. **Git集成**
   - 菜单: 编辑器 → 编辑器设置 → 版本控制
   - 启用"版本控制"
   - 设置Git路径

2. **忽略文件配置**
   - 项目已包含 `.gitignore` 文件
   - 确保忽略以下文件类型:
     ```
     *.import
     *.tmp
     *.uid
     .godot/
     ```

3. **提交前检查**
   - 使用格式化插件格式化所有代码
   - 运行基本测试确保项目可正常启动

## 依赖管理

### 内置插件说明

1. **Simple GDScript Formatter**
   - 版本: 0.4.7
   - 功能: 自动格式化GDScript代码
   - 位置: `addons/simple_gdscript_formatter/`

2. **全局自动加载脚本**
   - Eventmanger: 事件管理器
   - Jlptn5: JLPT词汇数据管理
   - ChangeScenceLoad: 场景切换加载
   - AudioManager: 音频管理
   - Level: 关卡管理
   - SkillManager: 技能管理
   - globalSet: 全局设置

### 资源文件组织

1. **图像资源** (`asset/`)
   - 游戏UI元素
   - 角色和敌人精灵
   - 技能图标
   - 背景图片

2. **音频资源** (`sounds/`)
   - 音效文件 (.mp3格式)
   - 背景音乐 (如有)

3. **场景文件** (`.tscn`)
   - 游戏场景
   - UI界面
   - 角色和敌人预制体

4. **脚本文件** (`.gd`)
   - 游戏逻辑
   - UI控制
   - 数据管理

### 音频和图片资源

1. **音频格式要求**
   - 推荐格式: OGG Vorbis (音效), MP3 (音乐)
   - 采样率: 44.1 kHz
   - 比特率: 128-192 kbps

2. **图片格式要求**
   - 推荐格式: PNG (带透明度), JPG (照片)
   - 分辨率: 根据实际需求调整
   - 压缩: 使用Godot内置压缩设置

3. **资源导入设置**
   - 选择资源文件
   - 在导入面板中调整设置
   - 点击"重新导入"应用更改

## 运行和测试

### 启动项目

1. **在编辑器中运行**
   - 点击编辑器右上角的"播放"按钮
   - 或按 `F5` 键
   - 或按 `F6` 键运行当前场景

2. **从命令行运行**
   ```bash
   # 运行主场景
   godot --path /path/to/project --main-pack
   
   # 运行特定场景
   godot --path /path/to/project scene.tscn
   ```

3. **导出后运行**
   - 菜单: 项目 → 导出
   - 选择目标平台
   - 点击"导出项目"
   - 运行生成的可执行文件

### 测试场景运行

1. **主菜单测试**
   - 场景文件: `menu/menu.tscn`
   - 测试功能: 菜单导航、设置选项

2. **主游戏测试**
   - 场景文件: `main/main.tscn`
   - 测试功能: 答题系统、战斗机制

3. **商店系统测试**
   - 场景文件: `shop/shoping.tscn`
   - 测试功能: 技能购买、升级系统

4. **独立测试场景**
   - 场景文件: `test/test.tscn`
   - 用途: 功能测试和调试

### 调试配置

1. **调试器使用**
   - 在代码中设置断点: 点击行号左侧
   - 查看变量值: 将鼠标悬停在变量上
   - 调用堆栈: 调试面板中查看

2. **打印调试信息**
   ```gdscript
   # 基本打印
   print("调试信息")
   
   # 格式化打印
   print("变量值: %s" % variable)
   
   # 条件打印
   if debug_mode:
       print("调试模式信息")
   ```

3. **性能分析**
   - 菜单: 调试 → 性能分析器
   - 监控帧率和内存使用
   - 识别性能瓶颈

### 常见运行问题

1. **资源导入失败**
   - 检查文件路径是否正确
   - 确认文件格式受支持
   - 重新导入资源文件

2. **脚本错误**
   - 查看调试器输出面板
   - 检查语法错误
   - 验证变量和函数引用

3. **场景加载失败**
   - 确认场景文件存在
   - 检查场景依赖关系
   - 验证自动加载脚本

## 开发工具推荐

### 代码编辑器配置

1. **Visual Studio Code**
   - 安装Godot Tools扩展
   - 配置GDScript语言支持
   - 设置代码格式化规则

2. **扩展推荐**
   - Godot Tools
   - GDScript Language Server
   - GitLens (Git增强)
   - Prettier (代码格式化)

### GDScript插件

1. **必备插件**
   - Simple GDScript Formatter (已包含)
   - Git Integration (版本控制)

2. **推荐插件**
   - Scene Manager (场景管理)
   - Asset Library (资源库)
   - Pixelorama (像素艺术编辑器)

### 版本控制工具

1. **Git客户端**
   - SourceTree (图形界面)
   - GitKraken (图形界面)
   - GitHub Desktop (GitHub用户)

2. **Git工作流**
   - 功能分支开发
   - 定期提交更改
   - 编写清晰的提交信息

### 调试工具

1. **内置调试器**
   - 断点调试
   - 变量监视
   - 性能分析器

2. **外部工具**
   - Godot Remote Debug (远程调试)
   - Godot Inspector (运行时检查)

## 常见问题解决

### 导入错误

1. **资源导入失败**
   ```
   问题: 资源文件显示为红色，无法导入
   解决方案:
   1. 检查文件路径是否包含特殊字符
   2. 确认文件格式受Godot支持
   3. 尝试重新导入: 右键文件 → 重新导入
   4. 检查文件权限
   ```

2. **场景导入错误**
   ```
   问题: 场景文件无法打开或显示错误
   解决方案:
   1. 检查场景文件中的脚本引用
   2. 确认所有依赖资源已正确导入
   3. 查看调试器输出中的错误信息
   4. 尝试在文本编辑器中检查.tscn文件格式
   ```

### 插件加载问题

1. **Simple GDScript Formatter不工作**
   ```
   问题: 格式化快捷键无响应
   解决方案:
   1. 检查插件是否在项目设置中启用
   2. 重启Godot编辑器
   3. 检查插件文件完整性
   4. 重新安装插件
   ```

2. **插件冲突**
   ```
   问题: 多个插件导致编辑器不稳定
   解决方案:
   1. 禁用所有插件，逐个启用排查
   2. 检查插件版本兼容性
   3. 查看插件文档了解已知问题
   ```

### 资源缺失

1. **图片资源显示为问号**
   ```
   问题: 图片资源无法正确加载
   解决方案:
   1. 检查图片文件是否存在
   2. 确认.import文件是否正确
   3. 重新导入图片资源
   4. 检查图片文件是否损坏
   ```

2. **音频文件无法播放**
   ```
   问题: 音频文件加载但无法播放
   解决方案:
   1. 检查音频格式是否受支持
   2. 确认音频导入设置
   3. 检查AudioPlayer节点配置
   4. 测试系统音频输出
   ```

### 平台特定问题

1. **Windows特定问题**
   ```
   问题: 防病毒软件阻止Godot运行
   解决方案:
   1. 将Godot添加到防病毒软件白名单
   2. 使用管理员权限运行
   3. 检查Windows Defender设置
   ```

2. **macOS特定问题**
   ```
   问题: Godot无法打开或崩溃
   解决方案:
   1. 检查系统安全设置
   2. 允许来自未知开发者的应用
   3. 更新到最新的macOS版本
   ```

3. **Linux特定问题**
   ```
   问题: 缺少依赖库
   解决方案:
   1. 安装必要的OpenGL库
  ```bash
  sudo apt-get install libgl1-mesa-glx libx11-6
  ```
   2. 检查图形驱动程序
   3. 使用终端运行查看详细错误信息
   ```

### 性能问题

1. **编辑器运行缓慢**
   ```
   问题: Godot编辑器响应缓慢
   解决方案:
   1. 关闭不必要的面板
   2. 减少同时打开的场景数量
   3. 检查系统资源使用情况
   4. 更新显卡驱动程序
   ```

2. **游戏运行卡顿**
   ```
   问题: 游戏运行时帧率低
   解决方案:
   1. 使用性能分析器检查瓶颈
   2. 优化资源大小和格式
   3. 减少同时活动的对象数量
   4. 检查脚本中的性能问题
   ```

---

## 获取帮助

如果在环境搭建过程中遇到问题，可以通过以下方式获取帮助：

1. **查看官方文档**: [Godot官方文档](https://docs.godotengine.org/)
2. **社区论坛**: [Godot论坛](https://forum.godotengine.org/)
3. **项目Issues**: 在项目仓库提交Issue
4. **开发团队**: 联系项目维护者

---

**祝您开发愉快！** 🎮